# PRD: woo-chatbot – 실전형 AI 챗봇

## 1) 문제정의
- **배경**: 조직과 개인은 다양한 문서·코드·노트에서 정보를 찾아 대화형으로 활용하고 싶지만, 일반 챗봇은 맥락 유지, 출처 투명성, 안전성(PII/정치/위험)에서 한계를 보임.
- **문제**:
  - 대화 지속성 부족: 세션·히스토리 관리 미흡으로 “나와 대화하는 느낌”이 약함.
  - 신뢰성 부족: 출처가 불명확하고 할루시네이션 시 경고가 없음.
  - 보안/컴플라이언스 리스크: PII 저장·노출 위험, 민감 카테고리 대응 부재.
  - 운영 난이도: 모델/인프라 교체가 어려워 비용·성능 최적화가 힘듦.
- **기회**: Next.js + NestJS + Postgres(pgvector) 조합으로 프론트/백 분리, RAG, 모델 교체 가능 구조와 엄격한 안전가드를 통해 실무 투입 가능한 챗봇 제공.

## 2) 타깃 유저
- **개발팀/프로덕트팀**: 리서치·문서 질의, 코드 스니펫 설명·요약.
- **CS/영업/운영팀**: 정책·매뉴얼 기반 질의응답, 응답 로그 관리.
- **개인 파워유저**: 자신만의 지식베이스 업로드 후 대화형 검색.
- 권한 수준: 관리자(설정/로그 접근), 일반 사용자(대화/KB), 게스트(체험).

## 3) 핵심기능 (Must-have)
- **대화 경험**: 스트리밍 응답(SSE), 코드블록 복사, 소스출처 표시(문서/청크 링크), 메시지 편집/재생성.
- **모델 추상화**: `ModelProvider` 인터페이스로 OpenAI/Anthropic/Ollama/vLLM 교체.
- **RAG 파이프라인**: 문서 업로드 → 청크 분할 → 임베딩(pgvector) → 검색 → 프롬프트 구성.
- **안전가드**: 정치·시사 차단, 불법/위험 행위 차단, PII 탐지·마스킹·비저장.
- **운영가시성**: 대화/문서/청크/규제위반/텔레메트리 로깅, 소프트 삭제.

## 4) 비기능요건
- **성능**: p95 응답 시작 < 1.5s(캐시 적중 시 <0.8s), 토큰 스트림 지연 < 200ms.
- **가용성**: 웹 99.5%, 서버 99.9% (상용 배포 시 기준).
- **보안/프라이버시**: PII 저장 금지, 전송/저장 암호화, 최소 권한 원칙.
- **확장성**: 모델/벡터DB/스토리지 교체 용이성. 멀티테넌시 대비(테넌트ID 컬럼 설계).
- **관측성**: 요청 트레이싱, 에러/속도 지표, 비용 대시보드(토큰/초당 호출 수).

## 5) 성공지표 (North Star & Core Metrics)
- **대화 품질**: 사용자가 “도움이 됐다”로 평가한 비율 >= 40%.
- **신뢰성**: 출처 포함 응답 비율 >= 90%, 거절 정책 정확도 >= 95%.
- **활성도**: 주간 활성 사용자(WAU), 세션당 평균 메시지 수 >= 6.
- **성능/비용**: 평균 응답 시작 시간, 토큰당 비용, 캐시 적중률.

## 6) 리스크/가정
- **가정**: 최신 모델 사용 가능, 문서 저작권·보안 정책 준수, 합리적 데이터 양.
- **리스크**:
  - 모델 변경에 따른 품질 변동 → 모델 A/B, 회귀 테스트로 완화.
  - 민감 카테고리 오탐/미탐 → 키워드+ML 혼합 규칙, 휴리스틱 보강.
  - 비용 상승 → 요약 캐시, 임베딩 재사용, Top-k 튜닝.
  - 프라이버시 위반 → PII 마스킹, 삭제 정책, 접근 제어.

## 7) 롤아웃 전략
- **Phase 0 (내부 알파)**: 문서 업로드/질의·출처/스트리밍/거절 템플릿. 5~10명.
- **Phase 1 (클로즈드 베타)**: 멀티모델 스위치, 로깅 대시보드, 기본 관리자.
- **Phase 2 (오픈 베타)**: 사용량 한도·결제(선택), API 토큰, 조직 스페이스.
- **운영 전략**: 안전 정책 업데이트 주간 점검, 비용 모니터링, 성능 SLO 리뷰.

## 8) 범위 및 제외
- 포함: 웹/서버/DB/스키마/RAG/안전/배포 스크립트.
- 제외(초기): 실시간 음성, 모바일 앱, 장기 기억(파인튜닝), 플러그인 마켓.

## 9) 승인 기준
- 문서/코드 스캐폴드 준비, 기본 채팅 흐름 동작(로컬), 안전 가드 기본 동작, CI 빌드 통과.
